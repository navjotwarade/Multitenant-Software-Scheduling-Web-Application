{"changed":false,"filter":false,"title":"login.js","tooltip":"/login.js","value":"\nvar ejs = require(\"ejs\");\nvar mongodb=require(\"mongodb\");\nvar uri = 'mongodb://navjot:cmpe281team14@ds053877.mongolab.com:53877/lab4';\n\nfunction login(req,res){\n    ejs.renderFile('./views/index.ejs',function(err, result) {\n        // render on success\n        if (!err) {\n            res.end(result);\n        }\n        // render or error\n        else {\n            res.end('An error occurred');\n            console.log(err);\n        }\n    });\n    \n}\n\nfunction after_login(req,res){\n     var user =req.param(\"usr\");\n  var passwd=req.param(\"password\");\n \n    \n   console.log(\"username:\"+ user + \"password\"+passwd);\n\tmongodb.MongoClient.connect(uri, function(err, db) {\n\t    \n\t     if(err) throw err;\n    \n    var categories = db.collection('users');\n   categories.find({$and:[{\"email\":{$eq:user}},{\"password\":{$eq:passwd}}]}).toArray(function (err, docs) {   //email->username\n       console.log(docs[0].method);\n        if(err) throw err;\n\t       //console.log(docs[0].method);\n\t      //docs.proj_id\n\t      var method = docs[0].method;\n\t      var a = db.collection('userschema');       \n\t      \n\t      a.find({\"method\":method},{\"Datafields\":1, \"_id\":0}).toArray(function (err, docs) {\n\t          if(err) throw err;\n\t          //console.log(docs);\n\t          res.send(docs);                     //send schema rows\n\t            \n\t      });\n        });\n\t         \n\t});   \n}\n\nexports.login=login;\n\nexports.after_login=after_login;","undoManager":{"stack":[],"mark":-1,"position":-1},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":24,"column":4},"end":{"row":24,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1430860224000}